<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Module: RecordFilter::ActiveRecordExtension::ClassMethods</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Module</strong></td>
          <td class="class-name-in-header">RecordFilter::ActiveRecordExtension::ClassMethods</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../../files/lib/record_filter/active_record_rb.html">
                lib/record_filter/active_record.rb
                </a>
        &nbsp;(<a href="http://github.com/aub/record_filter/tree/master/lib/record_filter/active_record.rb"><acronym title="Concurrent Versioning System">CVS</acronym></a>)
        <br />
            </td>
        </tr>

        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">



   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000001">filter</a>&nbsp;&nbsp;
      <a href="#M000002">named_filter</a>&nbsp;&nbsp;
      <a href="#M000003">named_filters</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000001" class="method-detail">
        <a name="M000001"></a>

        <div class="method-heading">
          <a href="#M000001" class="method-signature">
          <span class="method-name">filter</span><span class="method-args">(&amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Create a <a href="ClassMethods.html#M000001">filter</a> on the fly to find
a set of results that matches the given criteria. This method, which can be
called on any ActiveRecord::Base subclass, accepts a block that defines the
contents of the <a href="ClassMethods.html#M000001">filter</a> and returns
a <a href="../Filter.html">Filter</a> object that contains a list of the
objects resulting from the query. See the documentation for <a
href="../DSL.html">RecordFilter::DSL</a> for more information on how to
specify the <a href="ClassMethods.html#M000001">filter</a>.
</p>
<h4>Parameters</h4>
<table>
<tr><td valign="top">block&lt;Proc&gt;:</td><td>A block that specifies the contents of the <a
href="ClassMethods.html#M000001">filter</a>.

</td></tr>
</table>
<h4>Returns</h4>
<table>
<tr><td valign="top"><a href="../Filter.html">Filter</a>:</td><td>The <a href="../Filter.html">Filter</a> object resulting from the query,
which can be treated as an array of the results.

</td></tr>
</table>
<h4>Example</h4>
<pre>
  Blog.filter do
    having(:posts).with(:name, nil)
  end
</pre>
<p>
@public
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000001-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000001-source">
<pre>
<span class="ruby-comment cmt"># File lib/record_filter/active_record.rb, line 30</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">filter</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
        <span class="ruby-constant">Filter</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000002" class="method-detail">
        <a name="M000002"></a>

        <div class="method-heading">
          <a href="#M000002" class="method-signature">
          <span class="method-name">named_filter</span><span class="method-args">(name, &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Create a new named <a href="ClassMethods.html#M000001">filter</a>, which
defines a function on the callee class that provides easy access to the
query defined by the <a href="ClassMethods.html#M000001">filter</a>. Any
number of named filters can be created on a class, and they can also be
chained to create complex queries out of simple building blocks. In
addition, named filters can accept any number of arguments in order to
allow customization of their behavior when used. For more details on how to
specify the contents of named filters, see the documentation for <a
href="../DSL.html">RecordFilter::DSL</a>.
</p>
<pre>
  Post.named_filter(:without_permalink) do
    with(:permalink, nil)
  end

  Post.named_filter(:created_after) do |time|
    with(:created_at).gt(time)
  end

  Post.without_permalink                             # :conditions =&gt; ['permalink IS NULL']
  Post.created_after(3.hours.ago)                    # :conditions =&gt; ['created_at &gt; ?', 3.hours.ago]
  Post.without_permalink.created_after(3.hours.ago)  # :conditions =&gt; ['permalink IS NULL AND created_at &gt; ?', 3.hours.ago]
</pre>
<h4>Raises</h4>
<table>
<tr><td valign="top"><a href="../InvalidFilterNameException.html">InvalidFilterNameException</a>:</td><td>There is already a named <a href="ClassMethods.html#M000001">filter</a>
with the given name on this class or one of its superclasses.

</td></tr>
</table>
<h4>Returns</h4>
<p>
nil
</p>
<p>
@public
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000002-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000002-source">
<pre>
<span class="ruby-comment cmt"># File lib/record_filter/active_record.rb, line 61</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">named_filter</span>(<span class="ruby-identifier">name</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
        <span class="ruby-identifier">name</span> = <span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_sym</span>
        <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">named_filters</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">name</span>)
          <span class="ruby-identifier">raise</span> <span class="ruby-constant">InvalidFilterNameException</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;A named filter with the name #{name} already exists on the class #{self.name}.&quot;</span>)
        <span class="ruby-keyword kw">end</span>
        <span class="ruby-identifier">local_named_filters</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">name</span>
        <span class="ruby-constant">DSL</span><span class="ruby-operator">::</span><span class="ruby-constant">DSLFactory</span><span class="ruby-operator">::</span><span class="ruby-identifier">get_subclass</span>(<span class="ruby-keyword kw">self</span>).<span class="ruby-identifier">module_eval</span> <span class="ruby-keyword kw">do</span>
          <span class="ruby-identifier">define_method</span>(<span class="ruby-identifier">name</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
        <span class="ruby-keyword kw">end</span>

        (<span class="ruby-keyword kw">class</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword kw">self</span>; <span class="ruby-keyword kw">self</span>; <span class="ruby-keyword kw">end</span>).<span class="ruby-identifier">instance_eval</span> <span class="ruby-keyword kw">do</span>
          <span class="ruby-identifier">define_method</span>(<span class="ruby-identifier">name</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-operator">*</span><span class="ruby-identifier">args</span><span class="ruby-operator">|</span>
            <span class="ruby-constant">Filter</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">name</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
          <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">nil</span>
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000003" class="method-detail">
        <a name="M000003"></a>

        <div class="method-heading">
          <a href="#M000003" class="method-signature">
          <span class="method-name">named_filters</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Retreive a list of named filters that apply to a specific class, including
ones that were defined in its superclasses.
</p>
<h4>Returns</h4>
<table>
<tr><td valign="top">Array:</td><td>A list of the names of the named filters, as symbols.

</td></tr>
</table>
<p>
@public
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000003-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000003-source">
<pre>
<span class="ruby-comment cmt"># File lib/record_filter/active_record.rb, line 86</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">named_filters</span>
        <span class="ruby-identifier">result</span> = <span class="ruby-identifier">local_named_filters</span>.<span class="ruby-identifier">dup</span>
        <span class="ruby-identifier">result</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-identifier">superclass</span>.<span class="ruby-identifier">named_filters</span>) <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">superclass</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">superclass</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:named_filters</span>))
        <span class="ruby-identifier">result</span>
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>